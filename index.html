<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Install the App · Shabbat WA</title>

  <!-- PWA essentials -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0b0b">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root { color-scheme: dark; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:#0b0b0b;
      color:#f2f2f2;
      line-height:1.35;
    }
    header{
      padding:18px 16px 10px;
      border-bottom:1px solid #242424;
      background:#0f0f0f;
      position:sticky;
      top:0;
      z-index:10;
    }
    h1{ margin:0 0 8px; font-size:18px; }
    .sub{ margin:0; opacity:.85; font-size:13px; }
    main{ padding:16px; max-width:720px; margin:0 auto; }
    .card{
      border:1px solid #242424;
      border-radius:12px;
      padding:14px;
      background:#101010;
      margin:14px 0;
    }
    .muted{ opacity:.78; font-size:13px; }
    .small{ opacity:.7; font-size:12px; }
    .warn{ border-left:4px solid #ffd54a; background:#14120a; }
    .grid{ display:grid; grid-template-columns:1fr; gap:10px; }

    a.btn, button{
      width:100%;
      background:#171717;
      color:#f2f2f2;
      border:1px solid #2b2b2b;
      border-radius:10px;
      padding:12px 12px;
      font-size:15px;
      cursor:pointer;
      text-decoration:none;
      display:inline-block;
      text-align:center;
    }
    .pill{
      display:inline-block;
      border:1px solid #2b2b2b;
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      opacity:.85;
      background:#0c0c0c;
    }
    .statusline{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
  </style>
</head>

<body>
  <header>
    <h1>Install “Shabbat WA”</h1>
    <p class="sub">A lightweight PWA (web app) for Washington Shabbat prep &amp; tools.</p>
  </header>

  <main>
    <section class="card warn">
      <strong>Halakhic note:</strong>
      <div class="muted" style="margin-top:6px;">
        This app is intended for <b>before</b> Shabbat/Yom Tov (preparation) and <b>after</b>.
        Please do not use on Shabbat or Yom Tov.
      </div>
    </section>

    <section class="card">
      <strong>Install on iPhone (Safari)</strong>
      <ol class="muted" style="margin:10px 0 0; padding-left:18px;">
        <li>Open this page in <b>Safari</b>.</li>
        <li>Tap the <b>Share</b> icon.</li>
        <li>Tap <b>Add to Home Screen</b>.</li>
        <li>Open the app from your Home Screen.</li>
      </ol>
    </section>

    <section class="card">
      <strong>Install on Android (Chrome)</strong>
      <ol class="muted" style="margin:10px 0 0; padding-left:18px;">
        <li>Open this page in <b>Chrome</b>.</li>
        <li>Tap the <b>⋮</b> menu.</li>
        <li>Tap <b>Install app</b> (or <b>Add to Home screen</b>).</li>
      </ol>
    </section>

    <section class="card">
      <strong>Open the app</strong>
      <div class="grid" style="margin-top:10px;">
        <a class="btn" href="./app.html">Open App Home</a>
        <button id="installBtn" type="button" style="display:none;">Install now</button>
      </div>

      <div class="statusline">
        <div class="pill" id="netPill">Checking connection…</div>
        <div class="pill" id="swPill">Service Worker: checking…</div>
      </div>

      <p class="small" style="margin-top:10px;">
        If “Install now” doesn’t appear, your browser may not support the prompt (iOS uses Add to Home Screen).
      </p>
    </section>
  </main>

  <script>
    // Online indicator
    const netPill = document.getElementById("netPill");
    function updateNetUI(){
      netPill.textContent = navigator.onLine ? "Online" : "Offline";
    }
    window.addEventListener("online", updateNetUI);
    window.addEventListener("offline", updateNetUI);
    updateNetUI();

    // Service worker registration
    const swPill = document.getElementById("swPill");
    (async () => {
      if (!("serviceWorker" in navigator)) {
        swPill.textContent = "Service Worker: unsupported";
        return;
      }
      try {
        await navigator.serviceWorker.register("./sw.js");
        swPill.textContent = "Service Worker: active";
      } catch {
        swPill.textContent = "Service Worker: failed";
      }
    })();

    // Optional install prompt (mainly Android/Chrome)
    let deferredPrompt = null;
    const installBtn = document.getElementById("installBtn");

    window.addEventListener("beforeinstallprompt", (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = "inline-block";
    });

    installBtn.addEventListener("click", async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      try { await deferredPrompt.userChoice; } catch {}
      deferredPrompt = null;
      installBtn.style.display = "none";
    });
  </script>
</body>
</html>
